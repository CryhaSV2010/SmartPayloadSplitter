services:
  # Основной сервер
  smart_payload_server:
    build: .
    container_name: smart_payload_server
    ports:
      - "5000:5000"
    volumes:
      - ./server:/app/server
    networks:
      - payload_network

  # Suricata IDS
  suricata_ids:
    image: jasonish/suricata:latest
    container_name: suricata_ids
    restart: unless-stopped
    privileged: true
    network_mode: "host"  # Важно для захвата сетевого трафика
    cap_add:
      - NET_ADMIN
      - SYS_NICE
      - NET_RAW
    volumes:
      - ./suricata/config:/etc/suricata
      - ./suricata/rules:/var/lib/suricata/rules
      - suricata_logs:/var/log/suricata
    command: >
      --af-packet
      -i any  # Используем any вместо eth0 для надёжности
      -l /var/log/suricata
      -c /etc/suricata/suricata.yaml
    depends_on:
      - smart_payload_server
    environment:
      - SURICATA_OPTIONS=-v

  # Просмотр логов Suricata
  suricata_logs_viewer:
    image: alpine:latest
    container_name: suricata_logs_viewer
    command: tail -f /var/log/suricata/fast.log
    volumes:
      - suricata_logs:/var/log/suricata
    networks:
      - payload_network

networks:
  payload_network:
    driver: bridge

volumes:
  suricata_logs: