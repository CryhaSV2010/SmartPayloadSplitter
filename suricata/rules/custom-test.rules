# Правила Suricata для тестирования Smart Payload Splitter
# Эти правила созданы для демонстрации обнаружения пейлоадов

# Правило для обнаружения wget команды (загрузка вредоносного скрипта)
alert http any any -> any any (msg:"Potential Malicious Download Detected - wget"; content:"wget"; nocase; sid:1000001; rev:1; classtype:trojan-activity;)

# Правило для обнаружения известной команды shell
alert http any any -> any any (msg:"Potential Shell Command Detected - /bin/bash"; content:"/bin/bash"; sid:1000002; rev:1; classtype:shellcode-detect;)

# Правило для обнаружения curl команды с pipe в bash
alert http any any -> any any (msg:"Potential Malicious Command - curl pipe to bash"; content:"curl"; nocase; content:"|"; distance:0; within:50; content:"bash"; distance:0; within:50; sid:1000003; rev:1; classtype:trojan-activity;)

# Правило для обнаружения reverse shell (обратное соединение)
alert http any any -> any any (msg:"Potential Reverse Shell Detected"; content:"/dev/tcp/"; sid:1000004; rev:1; classtype:trojan-activity;)

# Правило для обнаружения base64 декодирования с pipe в bash
alert http any any -> any any (msg:"Potential Base64 Obfuscation Detected"; content:"base64"; nocase; content:"|"; distance:0; within:30; content:"bash"; distance:0; within:30; sid:1000005; rev:1; classtype:policy-violation;)

# Правило для обнаружения Python выполнения удалённого кода
alert http any any -> any any (msg:"Potential Remote Code Execution - Python"; content:"python"; nocase; content:"exec"; distance:0; within:100; content:"urllib"; distance:0; within:100; sid:1000006; rev:1; classtype:trojan-activity;)

# Правило для обнаружения netcat (nc) команды
alert http any any -> any any (msg:"Potential Netcat Command Detected"; content:"nc "; nocase; content:"-e"; distance:0; within:20; sid:1000007; rev:1; classtype:trojan-activity;)

# Правило для обнаружения chmod +x (создание исполняемого файла)
alert http any any -> any any (msg:"Potential Executable File Creation - chmod +x"; content:"chmod +x"; sid:1000008; rev:1; classtype:policy-violation;)

# Правило для обнаружения множественных фрагментов (поведенческое правило)
alert http any any -> any any (msg:"Multiple Fragment Requests to Same Endpoint"; flow:established; threshold:type limit, track by_src, count 10, seconds 60; sid:1000009; rev:1; classtype:policy-violation;)

# Правило для обнаружения подозрительного API endpoint
alert http any any -> any any (msg:"Fragment API Endpoint Accessed"; content:"/api/fragment"; sid:1000010; rev:1; classtype:policy-violation;)

# Правило для обнаружения команды сборки пейлоада
alert http any any -> any any (msg:"Payload Assembly Command Detected"; content:"/api/assemble"; sid:1000011; rev:1; classtype:trojan-activity;)

# Правило для обнаружения полного пейлоада (комбинация нескольких сигнатур)
alert http any any -> any any (msg:"Complete Malicious Payload Detected"; content:"wget"; nocase; content:"/bin/bash"; distance:0; within:200; content:"chmod +x"; distance:0; within:200; sid:1000012; rev:1; classtype:trojan-activity;)
